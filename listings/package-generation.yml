assemble:
  needs:
    - select-java-version
  strategy:
    fail-fast: false
    matrix:
      os: [ windows-2022, macos-12, ubuntu-22.04 ]
  runs-on: ${{ matrix.os }}
  timeout-minutes: 180
  concurrency:
    group: ${{ github.workflow }}-build-${{ matrix.os }}-${{ github.event.number || github.ref }}
    cancel-in-progress: true
  steps:
    - name: Checkout
      uses: danysk/action-checkout@0.2.14
    # Generazione dei pacchetti
    - name: Generate packages
      shell: bash
      run: ./gradlew jpackageFull
    - name: Upload packages
      uses: actions/upload-artifact@v4.3.0
      with:
        name: installer-package-${{ runner.os }}
        path: build/package/*
        if-no-files-found: error
    - name: Generate jars
      if: ${{ runner.os == 'Linux' }}
      run: ./gradlew shadowJar
    - name: Upload FatJars
      if: ${{ runner.os == 'Linux' }}
      uses: actions/upload-artifact@v4.3.0
      with:
          name: fat-jars
          path: build/shadow/*
          if-no-files-found: error